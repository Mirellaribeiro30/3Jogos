<!DOCTYPE html>
<!-- Declara que este é um documento HTML5 -->
<html lang="pt-BR">
<!-- Define o idioma do conteúdo como Português do Brasil -->
<head>
<meta charset="UTF-8">
<!-- Define a codificação de caracteres como UTF-8 -->
<title>Falling Objects Game</title>
<!-- Título que aparece na aba do navegador -->

<style>
/* --- Estilos gerais da página --- */
html, body {
  margin:0; padding:0; width:100%; height:100%;
  /* Remove margens e padding padrão e ocupa 100% da tela */
  background:#111; /* Fundo escuro da página */
  overflow:hidden; /* Remove barras de rolagem */
  font-family:Arial; /* Define fonte usada na página */
  display:flex; justify-content:center; align-items:center;
  /* Centraliza todos os elementos dentro do body horizontal e verticalmente */
}

/* Canvas onde o jogo é desenhado */
canvas {
  background:#222; /* Fundo do canvas mais escuro que o body */
  border:2px solid #555; /* Borda cinza ao redor do canvas */
  display:block; /* Exibe como bloco */
}

/* HUD (Head-Up Display) - mostra pontuação e vidas */
#hud {
  position:fixed; /* Fica fixo na tela mesmo se rolasse */
  top:10px; left:10px; /* Distância do topo e da esquerda */
  color:white; font-size:20px; /* Cor e tamanho do texto */
  display:none; /* Inicialmente escondido */
}

/* Telas do jogo (start, instruções, game over) */
.screen {
  position:fixed; top:0; left:0; width:100%; height:100%;
  /* Cada tela ocupa toda a janela */
  display:flex; justify-content:center; align-items:center;
  /* Centraliza conteúdos horizontal e verticalmente */
  flex-direction:column; /* Organiza elementos em coluna */
  background:#111; /* Fundo escuro */
  color:white; /* Texto branco */
}

/* Input para número de vidas */
.screen input {
  width:50px; font-size:20px; text-align:center;
  /* Largura pequena, fonte maior, texto centralizado */
}

/* Botões */
.screen button {
  margin-top:20px; /* Espaço acima do botão */
  padding:10px 20px; /* Espaçamento interno do botão */
  font-size:20px; /* Fonte maior para visibilidade */
  cursor:pointer; /* Cursor de mão ao passar sobre o botão */
}

/* Tela de Game Over */
#gameOverScreen { 
  display:none; /* Inicialmente escondido */
  background:rgba(0,0,0,0.7); /* Fundo semi-transparente */
}

/* Tela de Instruções */
#instructionScreen {
  display:none; /* Escondido inicialmente */
  background: rgba(0,0,0,0.9); /* Fundo quase preto */
  text-align: center; /* Centraliza o texto */
  padding: 40px; /* Espaçamento interno */
  position: relative; /* Para posicionar o botão X */
  box-sizing: border-box; /* Inclui padding e borda na largura/altura */
}

/* Botão de fechar instruções */
#instructionScreen button {
  position: absolute; /* Posicionado em relação ao container */
  top: 10px; right: 10px; /* Canto superior direito */
  font-size: 20px;
  cursor: pointer;
}
</style>
</head>

<body>
<!-- Tela inicial de escolha de vidas -->
<div id="startScreen" class="screen">
  <h1>Escolha o número de vidas</h1>
  <input type="number" id="lifeInput" value="3" min="1" max="5">
  <!-- Input para escolher de 1 a 5 vidas -->
  <button id="startButton">Começar</button>
</div>

<!-- Tela de instruções -->
<div id="instructionScreen" class="screen">
  <h1>Instruções do Jogo</h1>
  <p>Desvie dos asteroides e colete as estrelas para aumentar a pontuação.</p>
  <p>Use o mouse para mover a nave.</p>
  <button id="closeInstructions">X</button>
</div>

<!-- HUD do jogo -->
<div id="hud">
  <div id="score">Pontuação: 0</div>
  <div id="lives">Vidas: 3</div>
</div>

<!-- Canvas onde o jogo acontece -->
<canvas id="gameCanvas" width="600" height="800" style="display:none;"></canvas>

<!-- Tela de Game Over -->
<div id="gameOverScreen" class="screen">
  <h1>GAME OVER</h1>
  <p id="finalScore"></p>
  <button id="restartButton">Reiniciar</button>
</div>

<script>
// --- ÁUDIO ---
// Sons do jogo
const starSound = new Audio('star.mp3'); // Som ao pegar estrela
const hitSound = new Audio('hit.mp3');   // Som ao bater em asteroide
const bgm = new Audio('bgm.mp3');        // Música de fundo
bgm.loop=true; bgm.volume=0.3;          // Loop contínuo e volume baixo

// --- VARIÁVEIS PRINCIPAIS ---
const canvas = document.getElementById('gameCanvas'); // Canvas do jogo
const ctx = canvas.getContext('2d');                  // Contexto de desenho 2D
const gameWidth = canvas.width;                       // Largura inicial do canvas
const gameHeight = canvas.height;                     // Altura inicial do canvas

// Posição do mouse
let mouseX = gameWidth / 2; // Inicializa no meio horizontal do canvas

// Estado do jogo
let score = 0;        // Pontuação atual
let lives = 3;        // Vidas restantes
let level = 1;        // Nível atual
let fallSpeed = 3;    // Velocidade de queda dos objetos
let spawnInterval = 1000; // Intervalo de spawn de objetos em milissegundos
let lastSpawn = 0;        // Timestamp do último spawn

// Objetos e partículas
let objects = [];           // Lista de asteroides e estrelas ativos
let starsBackground = [];   // Lista de estrelas de fundo
let asteroidParticles = []; // Partículas de asteroides
let explosionParticles = [];// Partículas de explosão
let selectedLives = 3;      // Vidas escolhidas pelo jogador

// Jogador
const player = {
  x: gameWidth / 2 - 20,  // Posição X inicial (meio da tela)
  y: gameHeight - 90,     // Posição Y inicial (próximo ao fundo)
  width: 40, height: 60,  // Tamanho da nave
  speed: 10               // Velocidade (não usada)
};

// Estado do jogo: start, playing, gameover
let gameState = "start";

// --- ELEMENTOS HTML ---
const startScreen = document.getElementById('startScreen'); // Tela inicial
const lifeInput = document.getElementById('lifeInput');     // Input de vidas
const startButton = document.getElementById('startButton'); // Botão começar
const instructionScreen = document.getElementById('instructionScreen'); // Tela de instruções
const closeInstructions = document.getElementById('closeInstructions'); // Botão fechar instruções
const hud = document.getElementById('hud');                 // HUD
const scoreEl = document.getElementById('score');          // Texto pontuação
const livesEl = document.getElementById('lives');          // Texto vidas
const gameOverScreen = document.getElementById('gameOverScreen'); // Tela Game Over
const finalScore = document.getElementById('finalScore');  // Texto pontuação final
const restartButton = document.getElementById('restartButton'); // Botão reiniciar

// --- EVENTOS ---
// Botão começar: seleciona vidas e mostra instruções
startButton.addEventListener('click', () => {
  let chosen = parseInt(lifeInput.value); // Lê valor do input
  if(isNaN(chosen) || chosen < 1) chosen = 1; // Limite mínimo
  if(chosen > 5) chosen = 5;                 // Limite máximo
  lives = selectedLives = chosen;            // Salva vidas escolhidas
  score = 0; level = 1; fallSpeed = 3; spawnInterval = 1000; objects = []; // Reset game
  startScreen.style.display='none';         // Esconde tela inicial
  instructionScreen.style.display='flex';   // Mostra instruções
});

// Botão fechar instruções: inicia o jogo
closeInstructions.addEventListener('click', () => {
  instructionScreen.style.display='none'; // Esconde instruções
  canvas.style.display='block';           // Mostra canvas
  hud.style.display='block';              // Mostra HUD
  createBackgroundStars(100);             // Cria 100 estrelas de fundo
  lastSpawn = Date.now();                 // Marca horário do último spawn
  gameState='playing';                    // Muda estado para "playing"
  bgm.currentTime=0; bgm.play();          // Reinicia e toca música
  requestAnimationFrame(gameLoop);        // Inicia loop do jogo
});

// Botão reiniciar no Game Over
restartButton.addEventListener('click', () => {
  lives = selectedLives; score = 0; level = 1; fallSpeed = 3; spawnInterval = 1000; objects = [];
  asteroidParticles = []; explosionParticles = [];
  createBackgroundStars(100);             // Cria estrelas de fundo
  gameOverScreen.style.display='none';    // Esconde tela Game Over
  canvas.style.display='block'; hud.style.display='block'; // Mostra canvas e HUD
  gameState='playing'; bgm.currentTime=0; bgm.play();      // Reinicia música e jogo
  requestAnimationFrame(gameLoop);        // Reinicia loop
});

// Movimento do mouse
canvas.addEventListener('mousemove', e=>{
  const rect = canvas.getBoundingClientRect(); // Pega posição do canvas na tela
  mouseX = e.clientX - rect.left;              // Calcula posição X relativa ao canvas
});

// --- FUNÇÕES ---
// Cria estrelas de fundo com efeito de pulsar
function createBackgroundStars(num) {
  starsBackground = []; // Reseta lista de estrelas
  for(let i=0;i<num;i++){
    starsBackground.push({
      x:Math.random()*gameWidth,      // Posição X aleatória
      y:Math.random()*gameHeight,     // Posição Y aleatória
      size:Math.random()*2+1,         // Tamanho da estrela
      speed:Math.random()*0.5+0.2,    // Velocidade de queda
      alpha:Math.random(),             // Transparência inicial
      pulse:Math.random()*0.05         // Velocidade de pulso de brilho
    });
  }
}

// Desenha o fundo com estrelas pulsantes
function drawBackground(){
  ctx.fillStyle="#222"; ctx.fillRect(0,0,gameWidth,gameHeight); // Fundo escuro
  starsBackground.forEach(star=>{
    star.alpha += star.pulse; if(star.alpha>1||star.alpha<0.2) star.pulse*=-1; // Faz pulsar
    ctx.beginPath();
    const gradient=ctx.createRadialGradient(star.x,star.y,0,star.x,star.y,star.size*2);
    gradient.addColorStop(0, `rgba(255,255,200,${star.alpha})`);
    gradient.addColorStop(0.5, `rgba(255,255,255,${star.alpha*0.8})`);
    gradient.addColorStop(1,"transparent");
    ctx.fillStyle=gradient;
    ctx.arc(star.x,star.y,star.size*2,0,Math.PI*2); ctx.fill();
    star.y+=star.speed; if(star.y>gameHeight) star.y=0; // Reinicia topo quando passa da tela
  });
}

// --- OBJETOS ---
// Cria novos objetos aleatoriamente (asteroide ou estrela)
function spawnObject(){
  const type=Math.random()<0.7?"asteroid":"star"; // 70% asteroide, 30% estrela
  objects.push({
    x:Math.random()*(gameWidth-50), // Posição X aleatória
    y:-50,                           // Começa acima da tela
    width:type==="asteroid"?50:30,   // Tamanho depende do tipo
    height:type==="asteroid"?50:30,
    type:type
  });
}

// Atualiza posição e colisões dos objetos
function updateObjects(){
  const now = Date.now();                // Hora atual
  if(now-lastSpawn>spawnInterval){ spawnObject(); lastSpawn=now; } // Cria novo objeto
  for(let i=objects.length-1;i>=0;i--){ // Percorre objetos
    const obj = objects[i]; obj.y+=fallSpeed; // Move objeto para baixo

    // Colisão com jogador
    if(obj.x<player.x+player.width && obj.x+obj.width>player.x &&
       obj.y<player.y+player.height && obj.y+obj.height>player.y){
      if(obj.type==="star"){ 
        score++; 
        starSound.currentTime=0; starSound.play(); 
      } else { 
        lives--; 
        hitSound.currentTime=0; hitSound.play(); 
        spawnExplosionParticles(player.x+player.width/2, player.y+player.height/2); 
        if(lives<=0) gameState='gameover'; 
      }
      objects.splice(i,1); checkLevelUp(); continue; // Remove objeto
    }

    if(obj.type==="asteroid") spawnAsteroidParticles(obj.x+obj.width/2, obj.y+obj.height/2); // Partículas
    if(obj.y>gameHeight) objects.splice(i,1); // Remove objetos fora da tela
  }
}

// Checa se jogador subiu de nível
function checkLevelUp(){
  if(score>0 && score%10===0){ 
    level++; 
    fallSpeed+=0.5; 
    if(spawnInterval>300) spawn
    Interval-=80; // Diminui o intervalo de spawn a cada 10 pontos
  }
}

// --- PARTICULAS ---
// Cria partículas de asteroide para efeito visual
function spawnAsteroidParticles(cx,cy,color="#bbb",count=2){ 
  for(let i=0;i<count;i++) 
    asteroidParticles.push({
      x:cx, y:cy, 
      vx:(Math.random()-0.5)*2, vy:(Math.random()-0.5)*2, // Velocidade aleatória
      size:Math.random()*3+1, color:color, life:25 // Tamanho, cor e duração
    }); 
}

// Cria partículas de explosão quando o jogador é atingido
function spawnExplosionParticles(cx,cy,count=20){ 
  for(let i=0;i<count;i++) 
    explosionParticles.push({
      x:cx, y:cy, 
      vx:(Math.random()-0.5)*4, vy:(Math.random()-0.5)*4, // Velocidade aleatória
      size:Math.random()*4+2, 
      color:`rgba(${Math.floor(Math.random()*255)},${Math.floor(Math.random()*255)},0,1)`, // Cor aleatória
      life:40 // Duração da partícula
    }); 
}

// Atualiza partículas, remove quando a vida acaba
function updateParticles(){ 
  for(let i=asteroidParticles.length-1;i>=0;i--){ 
    let p=asteroidParticles[i];
    p.x+=p.vx; p.y+=p.vy; p.life--; 
    if(p.life<=0) asteroidParticles.splice(i,1); // Remove partículas mortas
  }
  for(let i=explosionParticles.length-1;i>=0;i--){
    let p=explosionParticles[i];
    p.x+=p.vx; p.y+=p.vy; p.life--; 
    if(p.life<=0) explosionParticles.splice(i,1);
  }
}

// Desenha partículas na tela
function drawParticles(){ 
  asteroidParticles.forEach(p=>{
    ctx.fillStyle=p.color;
    ctx.beginPath();
    ctx.arc(p.x,p.y,p.size,0,Math.PI*2);
    ctx.fill();
  });
  explosionParticles.forEach(p=>{
    ctx.fillStyle=p.color;
    ctx.beginPath();
    ctx.arc(p.x,p.y,p.size,0,Math.PI*2);
    ctx.fill();
  });
}

// --- DESENHO OBJETOS ---
// Desenha um asteroide
function drawAsteroid(obj){ 
  const cx=obj.x+obj.width/2, cy=obj.y+obj.height/2, r=obj.width/2; 
  ctx.fillStyle="#888"; ctx.beginPath(); ctx.arc(cx,cy,r,0,Math.PI*2); ctx.fill(); 
  ctx.fillStyle="#666"; ctx.beginPath(); ctx.arc(cx-r*0.3,cy-r*0.2,r*0.2,0,Math.PI*2); ctx.fill(); 
  ctx.beginPath(); ctx.arc(cx+r*0.2,cy+r*0.3,r*0.15,0,Math.PI*2); ctx.fill(); 
  ctx.strokeStyle="#555"; ctx.stroke(); 
}

// Desenha uma estrela
function drawStar(obj){ 
  const cx=obj.x+obj.width/2, cy=obj.y+obj.height/2, spikes=5, outerR=obj.width/2, innerR=outerR/2; 
  let rot=Math.PI/2*3, step=Math.PI/spikes; 
  ctx.fillStyle="gold"; ctx.beginPath(); 
  ctx.moveTo(cx,cy-outerR); 
  for(let i=0;i<spikes;i++){ 
    ctx.lineTo(cx+Math.cos(rot)*outerR,cy+Math.sin(rot)*outerR); rot+=step; 
    ctx.lineTo(cx+Math.cos(rot)*innerR,cy+Math.sin(rot)*innerR); rot+=step; 
  } 
  ctx.closePath(); ctx.fill(); 
}

// Desenha todos os objetos (asteroides e estrelas)
function drawObjects(){ 
  objects.forEach(o=>o.type==="asteroid"?drawAsteroid(o):drawStar(o)); 
}

// --- PLAYER ---
// Atualiza posição do jogador com base no mouse
function updatePlayer(){
  player.x += (mouseX - player.x - player.width/2)*0.1; // Movimento suave
  if(player.x<0) player.x=0; // Limite esquerda
  if(player.x>gameWidth-player.width) player.x=gameWidth-player.width; // Limite direita
}

// Desenha o jogador na tela
function drawPlayer(){
  ctx.fillStyle="gray"; ctx.fillRect(player.x,player.y,player.width,player.height);
  const blink=Math.random()*0.5+0.5; // Efeito de brilho
  ctx.fillStyle=`rgba(0,191,255,${blink})`;
  ctx.fillRect(player.x+player.width*0.3,player.y+player.height*0.1,player.width*0.4,player.height*0.25);
  // Desenha detalhes vermelhos da nave
  ctx.fillStyle="red";
  ctx.beginPath(); 
  ctx.moveTo(player.x,player.y+player.height*0.6); 
  ctx.lineTo(player.x-12,player.y+player.height); 
  ctx.lineTo(player.x+player.width*0.5,player.y+player.height*0.7); 
  ctx.closePath(); ctx.fill();
  ctx.beginPath(); 
  ctx.moveTo(player.x+player.width,player.y+player.height*0.6); 
  ctx.lineTo(player.x+player.width+12,player.y+player.height); 
  ctx.lineTo(player.x+player.width*0.5,player.y+player.height*0.7); 
  ctx.closePath(); ctx.fill();
}

// --- HUD ---
// Atualiza a pontuação e vidas na tela
function updateHUD(){ 
  scoreEl.innerText="Pontuação: "+score; 
  livesEl.innerText="Vidas: "+lives; 
}

// --- LOOP PRINCIPAL ---
// Função que roda o jogo a cada frame
function gameLoop(){
  if(gameState!=="playing"){ // Se não estiver jogando
    if(gameState==="gameover"){ // Se acabou
      bgm.pause(); 
      canvas.style.display='none'; hud.style.display='none'; gameOverScreen.style.display='flex';
      finalScore.innerText="Pontuação final: "+score;
    }
    return; // Para o loop
  }
  drawBackground(); // Desenha fundo
  updatePlayer(); // Atualiza posição do jogador
  updateObjects(); // Atualiza objetos (queda, colisão)
  updateParticles(); // Atualiza partículas
  drawObjects(); // Desenha objetos
  drawPlayer(); // Desenha jogador
  drawParticles(); // Desenha partículas
  updateHUD(); // Atualiza HUD
  requestAnimationFrame(gameLoop); // Chama próximo frame
}
</script>
</body>
</html>
