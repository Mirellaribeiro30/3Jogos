<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Falling Objects Game</title>
<style>
html, body {
  margin:0; padding:0; width:100%; height:100%;
  background:#111; overflow:hidden;
  font-family:Arial;
  display:flex; justify-content:center; align-items:center;
}
canvas {
  background:#222;
  border:2px solid #555;
  display:block;
}
#hud {
  position:fixed; top:10px; left:10px;
  color:white; font-size:20px;
  display:none;
}
.screen {
  position:fixed; top:0; left:0; width:100%; height:100%;
  display:flex; justify-content:center; align-items:center;
  flex-direction:column;
  background:#111; color:white;
}
.screen input { width:50px; font-size:20px; text-align:center; }
.screen button {
  margin-top:20px; padding:10px 20px;
  font-size:20px; cursor:pointer;
}
#gameOverScreen { display:none; background:rgba(0,0,0,0.7); }
#instructionScreen {
  display:none;
  background: rgba(0,0,0,0.9);
  text-align: center; padding: 40px;
  position: relative; box-sizing: border-box;
}
#instructionScreen button {
  position: absolute; top: 10px; right: 10px;
  font-size: 20px; cursor: pointer;
}
</style>
</head>
<body>

<div id="startScreen" class="screen">
  <h1>Escolha o número de vidas</h1>
  <input type="number" id="lifeInput" value="3" min="1" max="5">
  <button id="startButton">Começar</button>
</div>

<div id="instructionScreen" class="screen">
  <h1>Instruções do Jogo</h1>
  <p>Desvie dos asteroides e colete as estrelas para aumentar a pontuação.</p>
  <p>Use o mouse ou toque na tela para mover a nave.</p>
  <button id="closeInstructions">X</button>
</div>

<div id="hud">
  <div id="score">Pontuação: 0</div>
  <div id="lives">Vidas: 3</div>
</div>

<canvas id="gameCanvas" width="600" height="800" style="display:none;"></canvas>

<div id="gameOverScreen" class="screen">
  <h1>GAME OVER</h1>
  <p id="finalScore"></p>
  <button id="restartButton">Reiniciar</button>
</div>

<script>
// --- ÁUDIO ---
const starSound = new Audio('star.mp3');
const hitSound = new Audio('hit.mp3');
const bgm = new Audio('bgm.mp3'); bgm.loop=true; bgm.volume=0.3;

// --- VARIÁVEIS ---
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const gameWidth = canvas.width, gameHeight = canvas.height;
let mouseX = gameWidth / 2;
let score = 0, lives = 3, level = 1, fallSpeed = 3, spawnInterval = 1000, lastSpawn = 0;
let objects = [], starsBackground = [], asteroidParticles = [], explosionParticles = [];
let selectedLives = 3;
const player = { x: gameWidth/2-20, y: gameHeight-90, width:40, height:60 };
let gameState = "start";

// --- ELEMENTOS HTML ---
const startScreen = document.getElementById('startScreen');
const lifeInput = document.getElementById('lifeInput');
const startButton = document.getElementById('startButton');
const instructionScreen = document.getElementById('instructionScreen');
const closeInstructions = document.getElementById('closeInstructions');
const hud = document.getElementById('hud');
const scoreEl = document.getElementById('score');
const livesEl = document.getElementById('lives');
const gameOverScreen = document.getElementById('gameOverScreen');
const finalScore = document.getElementById('finalScore');
const restartButton = document.getElementById('restartButton');

// --- EVENTOS ---
startButton.addEventListener('click', () => {
  let chosen = parseInt(lifeInput.value);
  if(isNaN(chosen) || chosen < 1) chosen = 1;
  if(chosen > 5) chosen = 5;
  lives = selectedLives = chosen;
  score = 0; level = 1; fallSpeed = 3; spawnInterval = 1000; objects = [];
  startScreen.style.display='none';
  instructionScreen.style.display='flex';
});

closeInstructions.addEventListener('click', () => {
  instructionScreen.style.display='none';
  canvas.style.display='block'; hud.style.display='block';
  createBackgroundStars(100); lastSpawn = Date.now();
  gameState='playing'; bgm.currentTime=0; bgm.play();
  requestAnimationFrame(gameLoop);
});

restartButton.addEventListener('click', () => {
  lives = selectedLives; score = 0; level = 1; fallSpeed = 3; spawnInterval = 1000; objects = [];
  asteroidParticles = []; explosionParticles = [];
  createBackgroundStars(100);
  gameOverScreen.style.display='none';
  canvas.style.display='block'; hud.style.display='block';
  gameState='playing'; bgm.currentTime=0; bgm.play();
  requestAnimationFrame(gameLoop);
});

// --- MOVIMENTO RESPONSIVO ---
canvas.addEventListener('mousemove', e => {
  const rect = canvas.getBoundingClientRect();
  mouseX = e.clientX - rect.left;
});
canvas.addEventListener('touchstart', e => {
  const rect = canvas.getBoundingClientRect();
  mouseX = e.touches[0].clientX - rect.left;
  e.preventDefault();
});
canvas.addEventListener('touchmove', e => {
  const rect = canvas.getBoundingClientRect();
  mouseX = e.touches[0].clientX - rect.left;
  e.preventDefault();
});

// --- FUNÇÕES ---
function createBackgroundStars(num){
  starsBackground=[];
  for(let i=0;i<num;i++){
    starsBackground.push({
      x:Math.random()*gameWidth,
      y:Math.random()*gameHeight,
      size:Math.random()*2+1,
      speed:Math.random()*0.5+0.2,
      alpha:Math.random(),
      pulse:Math.random()*0.05
    });
  }
}

function drawBackground(){
  ctx.fillStyle="#222"; ctx.fillRect(0,0,gameWidth,gameHeight);
  starsBackground.forEach(star=>{
    star.alpha += star.pulse; if(star.alpha>1||star.alpha<0.2) star.pulse*=-1;
    const gradient=ctx.createRadialGradient(star.x,star.y,0,star.x,star.y,star.size*2);
    gradient.addColorStop(0, `rgba(255,255,200,${star.alpha})`);
    gradient.addColorStop(0.5, `rgba(255,255,255,${star.alpha*0.8})`);
    gradient.addColorStop(1,"transparent");
    ctx.fillStyle=gradient;
    ctx.beginPath(); ctx.arc(star.x,star.y,star.size*2,0,Math.PI*2); ctx.fill();
    star.y+=star.speed; if(star.y>gameHeight) star.y=0;
  });
}

// --- OBJETOS ---
function spawnObject(){
  const asteroidChance = Math.min(0.7 + level*0.03, 0.95);
  const type = Math.random() < asteroidChance ? "asteroid" : "star";

  // Evita spawn colado com outro objeto
  let x, tries = 0;
  do {
    x = Math.random()*(gameWidth-50);
    tries++;
  } while(objects.some(o => Math.abs(o.x - x) < 50) && tries < 10);

  objects.push({ x:x, y:-50, width:type==="asteroid"?50:30, height:type==="asteroid"?50:30, type:type });
}

function updateObjects(){
  const now = Date.now();
  if(now-lastSpawn>spawnInterval){ spawnObject(); lastSpawn=now; }
  for(let i=objects.length-1;i>=0;i--){
    const obj = objects[i]; obj.y+=fallSpeed;
    if(obj.x<player.x+player.width && obj.x+obj.width>player.x &&
       obj.y<player.y+player.height && obj.y+obj.height>player.y){
      if(obj.type==="star"){ score++; starSound.currentTime=0; starSound.play(); }
      else { lives--; hitSound.currentTime=0; hitSound.play(); spawnExplosionParticles(player.x+player.width/2, player.y+player.height/2); if(lives<=0) gameState='gameover'; }
      objects.splice(i,1); checkLevelUp(); continue;
    }
    if(obj.type==="asteroid") spawnAsteroidParticles(obj.x+obj.width/2, obj.y+obj.height/2);
    if(obj.y>gameHeight) objects.splice(i,1);
  }
}

function checkLevelUp(){
  if(score>0 && score%7===0){
    level++;
    fallSpeed += 0.7;
    if(spawnInterval>250) spawnInterval -= 70;
  }
}

// --- PARTICULAS ---
function spawnAsteroidParticles(cx,cy,color="#bbb",count=2){ 
  for(let i=0;i<count;i++) asteroidParticles.push({x:cx,y:cy,vx:(Math.random()-0.5)*2,vy:(Math.random()-0.5)*2,size:Math.random()*3+1,color:color,life:25});
}
function spawnExplosionParticles(cx,cy,count=20){ 
  for(let i=0;i<count;i++) explosionParticles.push({x:cx,y:cy,vx:(Math.random()-0.5)*4,vy:(Math.random()-0.5)*4,size:Math.random()*4+2,color:`rgba(${Math.floor(Math.random()*255)},${Math.floor(Math.random()*255)},0,1)`,life:40});
}
function updateParticles(){
  for(let i=asteroidParticles.length-1;i>=0;i--){let p=asteroidParticles[i]; p.x+=p.vx;p.y+=p.vy;p.life--; if(p.life<=0) asteroidParticles.splice(i,1);}
  for(let i=explosionParticles.length-1;i>=0;i--){let p=explosionParticles[i]; p.x+=p.vx;p.y+=p.vy;p.life--; if(p.life<=0) explosionParticles.splice(i,1);}
}
function drawParticles(){
  asteroidParticles.forEach(p=>{ctx.fillStyle=p.color;ctx.beginPath();ctx.arc(p.x,p.y,p.size,0,Math.PI*2);ctx.fill();});
  explosionParticles.forEach(p=>{ctx.fillStyle=p.color;ctx.beginPath();ctx.arc(p.x,p.y,p.size,0,Math.PI*2);ctx.fill();});
}

// --- DESENHO OBJETOS ---
function drawAsteroid(obj){
  const cx=obj.x+obj.width/2,cy=obj.y+obj.height/2,r=obj.width/2;
  ctx.fillStyle="#888"; ctx.beginPath(); ctx.arc(cx,cy,r,0,Math.PI*2); ctx.fill();
  ctx.fillStyle="#666"; ctx.beginPath(); ctx.arc(cx-r*0.3,cy-r*0.2,r*0.2,0,Math.PI*2); ctx.fill();
  ctx.beginPath(); ctx.arc(cx+r*0.2,cy+r*0.3,r*0.15,0,Math.PI*2); ctx.fill();
  ctx.strokeStyle="#555"; ctx.stroke();
}
function drawStar(obj){
  const cx=obj.x+obj.width/2,cy=obj.y+obj.height/2,spikes=5,outerR=obj.width/2,innerR=outerR/2;
  let rot=Math.PI/2*3,step=Math.PI/spikes;
  ctx.fillStyle="gold"; ctx.beginPath(); ctx.moveTo(cx,cy-outerR);
  for(let i=0;i<spikes;i++){ ctx.lineTo(cx+Math.cos(rot)*outerR,cy+Math.sin(rot)*outerR); rot+=step; ctx.lineTo(cx+Math.cos(rot)*innerR,cy+Math.sin(rot)*innerR); rot+=step; }
  ctx.closePath(); ctx.fill();
}
function drawObjects(){ objects.forEach(o=>o.type==="asteroid"?drawAsteroid(o):drawStar(o)); }

// --- PLAYER ---
function updatePlayer(){
  player.x = mouseX - player.width / 2;
  if(player.x < 0) player.x = 0;
  if(player.x > gameWidth - player.width) player.x = gameWidth - player.width;
}
function drawPlayer(){
  ctx.fillStyle="gray"; ctx.fillRect(player.x,player.y,player.width,player.height);
  const blink=Math.random()*0.5+0.5;
  ctx.fillStyle=`rgba(0,191,255,${blink})`;
  ctx.fillRect(player.x+player.width*0.3,player.y+player.height*0.1,player.width*0.4,player.height*0.25);
  ctx.fillStyle="red";
  ctx.beginPath(); ctx.moveTo(player.x,player.y+player.height*0.6); ctx.lineTo(player.x-12,player.y+player.height); ctx.lineTo(player.x+player.width*0.5,player.y+player.height*0.7); ctx.closePath(); ctx.fill();
  ctx.beginPath(); ctx.moveTo(player.x+player.width,player.y+player.height*0.6); ctx.lineTo(player.x+player.width+12,player.y+player.height); ctx.lineTo(player.x+player.width*0.5,player.y+player.height*0.7); ctx.closePath(); ctx.fill();
}

// --- HUD ---
function updateHUD(){ scoreEl.innerText="Pontuação: "+score; livesEl.innerText="Vidas: "+lives; }

// --- LOOP PRINCIPAL ---
function gameLoop(){
  if(gameState!=="playing"){
    if(gameState==="gameover"){ bgm.pause(); canvas.style.display='none'; hud.style.display='none'; gameOverScreen.style.display='flex'; finalScore.innerText="Pontuação final: "+score; }
    return;
  }
  drawBackground();
  updatePlayer();
  updateObjects();
  updateParticles();
  drawObjects();
  drawPlayer();
  drawParticles();
  updateHUD();
  requestAnimationFrame(gameLoop);
}
</script>
</body>
</html>
